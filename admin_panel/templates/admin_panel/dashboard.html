{% extends 'admin_panel/base.html' %}
{% block title %}Admin Dashboard ‚Äì BabyMuse{% endblock %}

{% block content %}
<h1 class="text-2xl font-bold mb-6 text-blue-600">Welcome to BabyMuse Admin Dashboard</h1>

<div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
  <div class="bg-white p-6 rounded-xl shadow text-center">
    <p class="text-gray-600 font-medium">Total Users</p>
    <h2 class="text-3xl font-bold text-blue-700">{{ total_users }}</h2>
  </div>
  <div class="bg-white p-6 rounded-xl shadow text-center">
    <p class="text-gray-600 font-medium">Total Orders</p>
    <h2 class="text-3xl font-bold text-blue-700">{{ total_orders }}</h2>
  </div>
  <div class="bg-white p-6 rounded-xl shadow text-center">
    <p class="text-gray-600 font-medium">Total Products</p>
    <h2 class="text-3xl font-bold text-blue-700">{{ total_products }}</h2>
  </div>
  <div class="bg-white p-6 rounded-xl shadow text-center">
    <p class="text-gray-600 font-medium">Total Revenue</p>
    <h2 class="text-3xl font-bold text-green-700">‚Çπ{{ total_revenue }}</h2>
  </div>
</div>

<h2 class="text-xl font-semibold text-gray-800 mt-10 mb-4">üìä Monthly Sales Comparison</h2>
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
  {% comment %} <div class="bg-white p-4 rounded-xl shadow">
    <h3 class="text-lg font-medium text-gray-700 mb-2">2024 Sales Distribution</h3>
    <canvas id="salesPie2024"></canvas>
  </div> {% endcomment %}
  <div class="bg-white p-4 rounded-xl shadow">
    <h3 class="text-lg font-medium text-gray-700 mb-2">2025 Sales Distribution</h3>
    <canvas id="salesPie2025"></canvas>
  </div>
</div>


<h2 class="text-xl font-semibold text-gray-800 mt-10 mb-4">üìí Ledger Summary</h2>
<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
  <div class="bg-white p-4 rounded-xl shadow text-center">
    <p class="text-gray-600 font-medium">Total Credit</p>
    <h2 class="text-xl font-bold text-green-600">‚Çπ{{ total_credit }}</h2>
  </div>
  <div class="bg-white p-4 rounded-xl shadow text-center">
    <p class="text-gray-600 font-medium">Total Debit</p>
    <h2 class="text-xl font-bold text-red-600">‚Çπ{{ total_debit }}</h2>
  </div>
  <div class="bg-white p-4 rounded-xl shadow text-center">
    <p class="text-gray-600 font-medium">Net Balance</p>
    <h2 class="text-xl font-bold text-blue-600">‚Çπ{{ net_balance }}</h2>
  </div>
</div>

<h3 class="text-lg font-semibold text-gray-700 mb-2">Recent Transactions</h3>
<table class="min-w-full bg-white rounded-xl shadow divide-y divide-gray-200">
  <thead class="bg-gray-50">
    <tr>
      <th class="px-4 py-2 text-left text-xs font-semibold text-gray-600">Date</th>
      <th class="px-4 py-2 text-left text-xs font-semibold text-gray-600">Type</th>
      <th class="px-4 py-2 text-left text-xs font-semibold text-gray-600">Amount</th>
      <th class="px-4 py-2 text-left text-xs font-semibold text-gray-600">Reason</th>
    </tr>
  </thead>
  <tbody class="divide-y divide-gray-100">
    {% for tx in ledger %}
    <tr>
      <td class="px-4 py-2 text-sm text-gray-700">{{ tx.created_at|date:"M d, Y H:i" }}</td>
      <td class="px-4 py-2 text-sm font-semibold {{ tx.transaction_type|yesno:'text-green-600,text-red-600' }}">{{ tx.transaction_type }}</td>
      <td class="px-4 py-2 text-sm">‚Çπ{{ tx.amount }}</td>
      <td class="px-4 py-2 text-sm text-gray-600">{{ tx.reason }}</td>
    </tr>
    {% empty %}
    <tr><td colspan="4" class="px-4 py-2 text-center text-sm text-gray-500">No transactions found.</td></tr>
    {% endfor %}
  </tbody>
</table>
<span>
<h2 class="text-xl font-semibold text-gray-800 mb-4">üßæ Latest Orders</h2>
<div class="overflow-x-auto bg-white rounded-xl shadow">
  <table class="min-w-full divide-y divide-gray-200">
    <thead class="bg-gray-50">
      <tr>
        <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Order ID</th>
        <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Customer</th>
        <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Date</th>
        <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Total</th>
        <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Status</th>
      </tr>
    </thead>
    <tbody class="divide-y divide-gray-100">
      {% for order in latest_orders %}
      <tr class="hover:bg-gray-50">
        <td class="px-6 py-4 text-sm text-gray-800 font-medium">{{ order.order_id }}</td>
        <td class="px-6 py-4 text-sm text-gray-700">{{ order.user.username }}</td>
        <td class="px-6 py-4 text-sm text-gray-700">{{ order.created_at|date:"M d, Y" }}</td>
        <td class="px-6 py-4 text-sm text-green-700 font-semibold">‚Çπ{{ order.total_price }}</td>
        <td class="px-6 py-4 text-sm text-blue-600">{{ order.status }}</td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="5" class="px-6 py-4 text-center text-sm text-gray-500">No recent orders found.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
<h2 class="text-xl font-semibold text-gray-800 mt-10 mb-4">üì¶ Top Selling Products</h2>
<ul class="bg-white rounded-xl shadow p-4 space-y-2">
  {% for item in top_products %}
    <li class="flex justify-between text-sm text-gray-700">
      <span>{{ item.product__name }}</span>
      <span class="font-semibold">{{ item.total_sold }} sold</span>
    </li>
  {% empty %}
    <li class="text-sm text-gray-500">No product data available.</li>
  {% endfor %}
</ul>

<h2 class="text-xl font-semibold text-gray-800 mt-10 mb-4">üóÇÔ∏è Top Categories</h2>
<ul class="bg-white rounded-xl shadow p-4 space-y-2">
  {% for item in top_categories %}
    <li class="flex justify-between text-sm text-gray-700">
      <span>{{ item.product__category__name }}</span>
      <span class="font-semibold">{{ item.total_sold }} sold</span>
    </li>
  {% empty %}
    <li class="text-sm text-gray-500">No category data available.</li>
  {% endfor %}
</ul>

<h2 class="text-xl font-semibold text-gray-800 mt-10 mb-4">üè∑Ô∏è Top Brands</h2>
<ul class="bg-white rounded-xl shadow p-4 space-y-2">
  {% for item in top_brands %}
    <li class="flex justify-between text-sm text-gray-700">
      <span>{{ item.product__brand__name }}</span>
      <span class="font-semibold">{{ item.total_sold }} sold</span>
    </li>
  {% empty %}
    <li class="text-sm text-gray-500">No brand data available.</li>
  {% endfor %}
</ul>
<h2 class="text-xl font-semibold text-gray-800 mt-10 mb-4">üìà Monthly Sales Overview</h2>
<canvas id="salesChart" class="bg-white rounded-xl shadow p-4"></canvas>



<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ctx = document.getElementById('salesChart').getContext('2d');
  const salesChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: {{ sales_chart_data.labels|safe }},
      datasets: [{
        label: 'Sales ‚Çπ',
        data: {{ sales_chart_data.totals|safe }},
        borderColor: '#3b82f6',
        backgroundColor: 'rgba(59, 130, 246, 0.1)',
        fill: true,
        tension: 0.3
      }]
    },
    options: {
      scales: {
        y: { beginAtZero: true }
      }
    }
  });


  const pieConfig = (labels, data, year) => ({
    type: 'pie',
    data: {
      labels: labels,
      datasets: [{
        label: `Sales ‚Çπ (${year})`,
        data: data,
        backgroundColor: [
          '#3b82f6', '#10b981', '#f59e0b', '#ef4444',
          '#8b5cf6', '#ec4899', '#14b8a6', '#f43f5e',
          '#6366f1', '#22c55e', '#eab308', '#0ea5e9'
        ],
        borderWidth: 1
      }]
    },
    options: {
      plugins: {
        legend: { position: 'bottom' },
        tooltip: { callbacks: {
          label: function(context) {
            const total = context.dataset.data.reduce((a, b) => a + b, 0);
            const value = context.raw;
            const percentage = ((value / total) * 100).toFixed(1);
            return `${context.label}: ‚Çπ${value} (${percentage}%)`;
          }
        }}
      }
    }
  });

  new Chart(document.getElementById('salesPie2025'), pieConfig({{ sales_2025.labels|safe }}, {{ sales_2025.totals|safe }}, 2025));
</script>
  
{% endblock %}